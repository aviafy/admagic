# ğŸ—ï¸ System Architecture Diagram

## Complete System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CLIENT / FRONTEND                               â”‚
â”‚                                                                          â”‚
â”‚  â€¢ Next.js Application                                                  â”‚
â”‚  â€¢ Content Submission Form                                              â”‚
â”‚  â€¢ Status Checking UI                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP Requests
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        REST API LAYER âœ…                                 â”‚
â”‚                     (NestJS Backend)                                     â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Content Controller                                     â”‚            â”‚
â”‚  â”‚  â€¢ POST /content/submit                                 â”‚            â”‚
â”‚  â”‚  â€¢ GET /content/status/:id                              â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                 â”‚                                                        â”‚
â”‚                 â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Content Service                                        â”‚            â”‚
â”‚  â”‚  â€¢ submitContent()                                      â”‚            â”‚
â”‚  â”‚  â€¢ getSubmissionStatus()                                â”‚            â”‚
â”‚  â”‚  â€¢ processModeration() (async)                          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                      â”‚
                  â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                   â”‚
    â†“                                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATABASE SERVICE âœ…             â”‚    â”‚  MODERATION SERVICE âœ…           â”‚
â”‚  (Supabase Client)               â”‚    â”‚  (AI Agent Orchestrator)        â”‚
â”‚                                  â”‚    â”‚                                  â”‚
â”‚  â€¢ createSubmission()            â”‚    â”‚  â€¢ moderateContent()            â”‚
â”‚  â€¢ updateSubmission()            â”‚    â”‚  â€¢ Uses: ModerationAgent        â”‚
â”‚  â€¢ getSubmission()               â”‚    â”‚                                  â”‚
â”‚  â€¢ createAuditLog()              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
               â”‚                                   â†“
               â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚              â”‚     LANGGRAPH AGENT âœ…                       â”‚
               â”‚              â”‚     (State Machine)                         â”‚
               â”‚              â”‚                                             â”‚
               â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
               â”‚              â”‚  â”‚  State Annotation                      â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ content                             â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ contentType                         â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ analysisResult                      â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ classification                      â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ decision                            â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ reasoning                           â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ needsVisualization                  â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ visualizationUrl                    â”‚ â”‚
               â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â”‚              â”‚                                             â”‚
               â”‚              â”‚  WORKFLOW:                                  â”‚
               â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
               â”‚              â”‚  â”‚         START                         â”‚ â”‚
               â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â”‚              â”‚                â†“                            â”‚
               â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
               â”‚              â”‚  â”‚  NODE 1: ANALYZE âœ…                   â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Uses: GPT-3.5-turbo                â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Analyzes content safety            â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Returns: analysisResult            â”‚ â”‚
               â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â”‚              â”‚                â†“                            â”‚
               â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
               â”‚              â”‚  â”‚  NODE 2: CLASSIFY âœ…                  â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Rule-based classification          â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Returns: safe/flagged/harmful      â”‚ â”‚
               â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â”‚              â”‚                â†“                            â”‚
               â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
               â”‚              â”‚  â”‚  ROUTER: routeClassification()        â”‚ â”‚
               â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â”‚              â”‚                â†“                            â”‚
               â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
               â”‚              â”‚  â”‚  NODE 3: DECIDE âœ…                    â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Makes final decision               â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Sets needsVisualization flag       â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Returns: decision, reasoning       â”‚ â”‚
               â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â”‚              â”‚                â†“                            â”‚
               â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
               â”‚              â”‚  â”‚  ROUTER: routeAfterDecision()         â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Checks needsVisualization          â”‚ â”‚
               â”‚              â”‚  â”‚  â€¢ Routes conditionally               â”‚ â”‚
               â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â”‚              â”‚                â”‚                            â”‚
               â”‚              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
               â”‚              â”‚    â”‚                        â”‚              â”‚
               â”‚              â”‚   YES                      NO              â”‚
               â”‚              â”‚    â”‚                        â”‚              â”‚
               â”‚              â”‚    â†“                        â†“              â”‚
               â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
               â”‚              â”‚  â”‚  NODE 4:    â”‚      â”‚   END   â”‚        â”‚
               â”‚              â”‚  â”‚  GENERATE   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
               â”‚              â”‚  â”‚  IMAGE âœ…   â”‚                          â”‚
               â”‚              â”‚  â”‚  â€¢ DALL-E 3 â”‚                          â”‚
               â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â”‚
               â”‚              â”‚         â†“                                  â”‚
               â”‚              â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
               â”‚              â”‚    â”‚   END   â”‚                            â”‚
               â”‚              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
               â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SUPABASE DATABASE âœ…                              â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Table: content_submissions                             â”‚            â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚            â”‚
â”‚  â”‚  â€¢ id (UUID)                                            â”‚            â”‚
â”‚  â”‚  â€¢ user_id (TEXT)                                       â”‚            â”‚
â”‚  â”‚  â€¢ content_type (TEXT/IMAGE)                            â”‚            â”‚
â”‚  â”‚  â€¢ content_text (TEXT)                                  â”‚            â”‚
â”‚  â”‚  â€¢ content_url (TEXT)                                   â”‚            â”‚
â”‚  â”‚  â€¢ status (pending/approved/flagged/rejected)           â”‚            â”‚
â”‚  â”‚  â€¢ ai_decision (JSONB) â† Stores AI results             â”‚            â”‚
â”‚  â”‚  â€¢ created_at (TIMESTAMP)                               â”‚            â”‚
â”‚  â”‚  â€¢ updated_at (TIMESTAMP)                               â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Table: audit_logs                                      â”‚            â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚            â”‚
â”‚  â”‚  â€¢ id (UUID)                                            â”‚            â”‚
â”‚  â”‚  â€¢ submission_id (UUID FK)                              â”‚            â”‚
â”‚  â”‚  â€¢ action (TEXT) â† submission_created, moderation_      â”‚            â”‚
â”‚  â”‚                     completed, moderation_error         â”‚            â”‚
â”‚  â”‚  â€¢ details (JSONB) â† Full audit trail                  â”‚            â”‚
â”‚  â”‚  â€¢ created_at (TIMESTAMP)                               â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†‘
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXTERNAL AI SERVICES         â”‚   â”‚  EXTERNAL AI SERVICES          â”‚
â”‚                               â”‚   â”‚                                â”‚
â”‚  OpenAI API âœ…                â”‚   â”‚  Google Gemini API âŒ          â”‚
â”‚  â€¢ GPT-3.5-turbo              â”‚   â”‚  â€¢ NOT IMPLEMENTED             â”‚
â”‚    (text analysis)            â”‚   â”‚                                â”‚
â”‚  â€¢ DALL-E 3                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    (image generation)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

### Flow 1: Content Submission âœ…

```
User â†’ Frontend â†’ POST /content/submit â†’ Content Service
                                              â†“
                                    Create Submission in DB
                                              â†“
                                    Create Audit Log (SUBMISSION_CREATED)
                                              â†“
                                    Return {submissionId, status: "pending"}
                                              â†“
                                    Trigger Async Moderation
                                              â†“
                                    Moderation Service
                                              â†“
                                    LangGraph Agent
                                              â†“
                                    ANALYZE â†’ CLASSIFY â†’ DECIDE â†’ [GENERATE IMAGE?]
                                              â†“
                                    Update Submission in DB
                                              â†“
                                    Create Audit Log (MODERATION_COMPLETED)
```

### Flow 2: Status Checking âœ…

```
User â†’ Frontend â†’ GET /content/status/:id â†’ Content Service
                                                  â†“
                                        Query Submission from DB
                                                  â†“
                                        Return {
                                          id,
                                          status,
                                          aiDecision: {
                                            decision,
                                            reasoning,
                                            visualizationUrl
                                          }
                                        }
```

---

## Component Status

### âœ… Implemented Components

```
REST API Layer âœ…
â”œâ”€â”€ ContentController âœ…
â”‚   â”œâ”€â”€ POST /content/submit âœ…
â”‚   â””â”€â”€ GET /content/status/:id âœ…
â””â”€â”€ ContentService âœ…
    â”œâ”€â”€ submitContent() âœ…
    â”œâ”€â”€ getSubmissionStatus() âœ…
    â””â”€â”€ processModeration() âœ…

Database Layer âœ…
â”œâ”€â”€ DatabaseService âœ…
â”‚   â”œâ”€â”€ createSubmission() âœ…
â”‚   â”œâ”€â”€ updateSubmission() âœ…
â”‚   â”œâ”€â”€ getSubmission() âœ…
â”‚   â””â”€â”€ createAuditLog() âœ…
â””â”€â”€ Supabase Tables âœ…
    â”œâ”€â”€ content_submissions âœ…
    â””â”€â”€ audit_logs âœ…

Moderation Layer âœ…
â”œâ”€â”€ ModerationService âœ…
â”‚   â””â”€â”€ moderateContent() âœ…
â””â”€â”€ LangGraph Agent âœ…
    â”œâ”€â”€ State Machine âœ…
    â”œâ”€â”€ Node 1: Analyze (GPT-3.5) âœ…
    â”œâ”€â”€ Node 2: Classify âœ…
    â”œâ”€â”€ Node 3: Decide âœ…
    â”œâ”€â”€ Node 4: Generate Image (DALL-E 3) âœ…
    â””â”€â”€ Conditional Routing âœ…

External Services
â”œâ”€â”€ OpenAI âœ…
â”‚   â”œâ”€â”€ GPT-3.5-turbo âœ…
â”‚   â””â”€â”€ DALL-E 3 âœ…
â””â”€â”€ Google Gemini âŒ (NOT IMPLEMENTED)
```

### âŒ Missing Components

```
AI Providers
â””â”€â”€ Google Gemini âŒ
    â”œâ”€â”€ Gemini API Integration âŒ
    â”œâ”€â”€ Text Analysis with Gemini âŒ
    â””â”€â”€ Provider Switching Logic âŒ

Image Analysis Tools âŒ
â”œâ”€â”€ Image Content Moderation âŒ
â”œâ”€â”€ OCR/Text Extraction âŒ
â”œâ”€â”€ NSFW Detection âŒ
â””â”€â”€ Visual Safety Checks âŒ

Tool Architecture âš ï¸
â”œâ”€â”€ Pluggable Tool System âŒ
â”œâ”€â”€ Tool Registry âŒ
â””â”€â”€ Dynamic Tool Loading âŒ
```

---

## Tech Stack

### Backend

- **Framework:** NestJS (TypeScript)
- **AI Orchestration:** LangGraph (@langchain/langgraph)
- **AI Provider:** OpenAI (GPT-3.5, DALL-E 3)
- **Database:** Supabase (PostgreSQL)
- **Validation:** class-validator

### Frontend

- **Framework:** Next.js (TypeScript)
- **Auth:** Supabase Auth
- **UI:** React Components

### Database

- **Provider:** Supabase
- **Type:** PostgreSQL
- **Tables:** content_submissions, audit_logs

### AI Services

- **Text Analysis:** OpenAI GPT-3.5-turbo âœ…
- **Image Generation:** OpenAI DALL-E 3 âœ…
- **Image Analysis:** âŒ Not implemented
- **Multi-Provider:** âŒ Only OpenAI

---

## API Endpoints

### POST /content/submit âœ…

**Purpose:** Submit content for moderation

**Request:**

```json
{
  "userId": "string",
  "contentType": "text" | "image",
  "contentText": "string (optional)",
  "contentUrl": "string (optional)"
}
```

**Response:**

```json
{
  "submissionId": "uuid",
  "status": "pending",
  "message": "Content submitted for moderation"
}
```

### GET /content/status/:id âœ…

**Purpose:** Get moderation status and results

**Response:**

```json
{
  "id": "uuid",
  "status": "approved" | "flagged" | "rejected" | "pending",
  "contentType": "text" | "image",
  "aiDecision": {
    "decision": "approved" | "flagged" | "rejected",
    "reasoning": "string",
    "classification": ["safe"] | ["flagged"] | ["harmful"],
    "analysisResult": {...},
    "visualizationUrl": "string (optional)"
  },
  "createdAt": "timestamp",
  "updatedAt": "timestamp"
}
```

---

## Conclusion

### âœ… Working System Architecture

Your system has a **solid, production-ready architecture** for text content moderation:

1. **REST API** - Complete endpoints âœ…
2. **LangGraph State Machine** - Proper workflow âœ…
3. **Supabase Storage** - Persistent data âœ…
4. **AI Moderation** - OpenAI integration âœ…
5. **Audit Trail** - Complete logging âœ…

### âŒ Missing Pieces

1. Gemini AI integration (if multi-provider is needed)
2. Image content analysis (only generation works)
3. More pluggable tool architecture

**Overall:** **~80% complete** and **production-ready** for text moderation! ğŸ‰
